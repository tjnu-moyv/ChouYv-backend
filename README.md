### [开发文档(简易版)](阿里开发规范-简易版.md) power by [阿里Java开发规范](https://developer.aliyun.com/ebook/386/92064)

# 丑鱼外卖页面设计

* 通过一个登录和注册页面进入(不同账号进入不同的页面)

## 学生用户页面(通过注册学生用户账号登录进入用户页面)

* 主导航栏两个内容(点餐和配送员)

### 配送员页面布局

* 左上角有头像可进入个人信息页面
* 第一次进入配送员页面需要填写一些承诺内容,并交押金
* 之后进入配送页面就显示一条条的所有订单(订单内容有餐厅名称和配送地址)可点击每个订单右边的抢单按钮可以抢单(
  点击抢单后进入订单详情页面)

### 订单详情页面布局

* 若商家配餐完成将会出现弹窗提醒配餐完成
* 左上角有头像可进入个人信息页面
* 显示订单的每个菜品内容,商家地址和用户地址
* 配送员到地之后检查无误之后点击订单下方的收餐
* 配送员送到用户手里之后点击确认交付给用户的按钮,在一个小时之后费用将会分别给配送员和商家

### 点餐页面布局布局

* 左上角有头像可进入个人信息页面
* 左侧分级导航栏(element折叠面板类型形式)可以选择用餐地址楼层, 选择之后出现那一楼层的餐厅信息
* 在最上面的主导航栏下面有搜索框(element带建议输入框, 并且可删除, 再加上选择器), 可搜索餐品类型或者餐厅名称,
  并且可以在搜索框左侧选择搜索范围
* 中间部分若没有任何选择和搜索显示推荐菜品, 若通过左侧导航栏选择餐厅地址和楼层将会取消推荐菜品位置出现那一楼层餐品,
  若有搜素内容只会在搜索的下拉菜单里面不会取代中间部分内容

### 菜品选择页面布局(点击商家之后进入)

* 左上角有头像可进入个人信息页面
* 左侧分级导航栏(element折叠面板类型形式, 或者树形控件类型), 选择不同种类商品(例如：荤、素等)
* 在最上面的主导航栏下面有搜索框(element带建议输入框, 并且可删除, 在加上选择器), 可搜索菜品名称, 并且可以在搜索框左侧选择搜索范围
* 中间为点击导航栏不同商品的信息和图片, 在菜品名字后面加上菜品剩余量 ,可以点击加入购物车, 购物车图标左上角数量+1
* 右下角购物车图标, 点击出现购物车里菜品弹窗, 点击确认之后进入支付页面

### 支付和确认订单页面布局(点击购物车确认按键之后进入)

* 左上角有头像可进入个人信息页面
* 上方三个单选框(堂食, 外带和配送), 点击堂食默认加入打包费, 点击外带默认加入配送费
* 下面为订单内容, 第一条可选择就餐时间(若点击配送第二行可选择配送地址或者新建地址, 新建地址跳转到个人信息页面)
* 订单内容之后最下面确认支付按钮(点击完之后进入订单信息页面)

### 订单信息页面布局(点击确认支付之后进入)

* 左上角有头像可进入个人信息页面
* 显示时间, 就餐地址(若配送显示配送地址和时间), 和所有商品内容, 以及价钱
* 最下方有取消订单和确认收餐(在配餐之前可以取消, 配餐之后取消需要罚款)

### 个人信息页面布局(点击右上角头衔之后进入)

* 大体内容为表单(element中的表单)信息包括:头像,昵称,修改收货地址和添加收获地址(其中收货地址也绑定电话),设置按钮(
  点击之后进入设置界面)
* 如果用户注册了配送员可以有取消配送员身份并且退还押金按钮

### 设置页面布局(点击个人信息界面的设置按钮之后进入)

* 显示用户名密码和修改用户名密码

## 商家页面(通过公司给商家的账号登录进入商家页面,商家不可以私自注册)

* 主导航栏三个内容(今日配餐、订单和添加删除菜品)

### 今日配餐页面布局

* 可以选择早中晚,并且加入不同菜品和添加菜品数量(element穿梭框),每次有人下单这一菜品将会减一,
  并且这一选项可以随时调整在任何时间,将会同步到用户查看的餐品那边显示餐品剩余量

### 订单页面布局

* 显示订单号和菜品内容和分量
* 配餐完成之后可以点击订单右侧的配餐完成, 将会通知配送员取餐, 配送员确定收餐后这个订单取消

### 添加和删除菜品界面页面布局

* 下面有添加过的菜品和分类, 页面参考用户查看商家的菜品页面, 上传图片和输入框,
  点击确认之后菜品出现在下面可以拖动到不同的组里(新添加的默认在最上面，之后可以拖动到任何组里)
* 也可以点击之前的商品进行修改商品的照片和文案

## 管理员页面(通过公司账号登录)

* 主导航栏三个内容(学生信息、商家信息和管理员信息)

### 学生信息页面布局

* 可以查看到每个学生的订单内容，并且可以通过学生用户名搜索这个学生最近订单

### 商家信息页面布局

* 可以添加商家，点击添加商家输入商家用户名和密码
* 也可以搜索商家查看商家的菜品内容，可以点击菜品内容进行提醒违规发送给商家让其修改

# 项目结构 项目逻辑

## 支付订单逻辑

1. 输入信息: orderId(订单id) studentId(学生id) password(支付密码 现阶段就是学生密码)
2. 根据学生id查询学生数据
    - 未查询到直接报错 请使用自己的账号支付(code=308)
3. 查询到之后 校验支付密码
    - 如果不对这返回 支付密码错误(code=308)
4. 支付密码正确之后 根据订单id和学生id查询订单信息
    - 如果查不到 返回找不到与您对应的订单(code=308)
5. 确认订单状态是未支付状态
    - 如果不是则返回订单已支付(也就是status>1)或者订单异常(status=-1)
6. 查到之后获取订单总价
7. 再根据学生id查询自己的余额
    - 如果自己余额不足(订单总价大于自己的余额) 返回余额不足(code=308)
8. 生成账单(区别于订单 账单是记录金钱交易) 将用户金钱转到公共账户
9. 将订单状态改成已支付(type=2)

# 丑鱼外卖数据库文档

## 数据库表总结

### `money` - 用户钱包表

| 字段名         | 类型         | 描述                |
|-------------|------------|-------------------|
| id          | bigint     | 钱包主键              |
| uid         | bigint     | 用户（学生、跑腿、商家等）ID   |
| cny         | bigint     | 人民币余额             |
| deposit_cny | int        | 人民币押金             |
| created_at  | datetime   | 创建时间              |
| updated_at  | datetime   | 更新时间              |
| is_deleted  | tinyint(1) | 逻辑删除（0-未删除，1-已删除） |

### `money_bill` - 账单表

| 字段名        | 类型         | 描述                       |
|------------|------------|--------------------------|
| id         | bigint     | 账单主键                     |
| from_id    | bigint     | 转出账户                     |
| to_id      | bigint     | 转入账户                     |
| money      | int        | 账单操作金额                   |
| type       | tinyint    | 转账类型（0-默认内部转账，1-充值，2-提现） |
| created_at | datetime   | 创建时间                     |
| updated_at | datetime   | 更新时间                     |
| is_deleted | tinyint(1) | 逻辑删除（0-未删除，1-已删除）        |

### `order` - 订单表

| 字段名         | 类型         | 描述                                |
|-------------|------------|-----------------------------------|
| id          | bigint     | 订单主键                              |
| student_id  | bigint     | 学生外键                              |
| run_id      | bigint     | 跑腿外键                              |
| shop_id     | bigint     | 商家外键                              |
| total_price | int        | 商品总价                              |
| status      | tinyint    | 订单状态（0-备餐中，1-等待跑腿取，2-配送中，3-商品已到达） |
| type        | tinyint    | 订单类型（0-堂食，1-带走，2-找跑腿）             |
| target_time | datetime   | 预约时间                              |
| created_at  | datetime   | 创建时间                              |
| updated_at  | datetime   | 更新时间                              |
| is_deleted  | tinyint(1) | 逻辑删除（0-未删除，1-已删除）                 |

### `order_shop_products_item` - 订单商品表

| 字段名              | 类型           | 描述                |
|------------------|--------------|-------------------|
| id               | bigint       | 订单商品主键            |
| order_id         | bigint       | 订单外键              |
| shop_products_id | bigint       | 商品外键              |
| count            | tinyint      | 商品数量              |
| description      | varchar(256) | 商品备注              |
| created_at       | datetime     | 创建时间              |
| updated_at       | datetime     | 更新时间              |
| is_deleted       | tinyint(1)   | 逻辑删除（0-未删除，1-已删除） |

### `shop` - 商家表

| 字段名        | 类型           | 描述                |
|------------|--------------|-------------------|
| id         | bigint       | 商家主键              |
| username   | varchar(256) | 商家登陆账号            |
| password   | varchar(512) | 商家登陆密码            |
| nickname   | varchar(256) | 商家名称              |
| address    | varchar(256) | 商家地址              |
| phone      | varchar(256) | 商家联系电话            |
| created_at | datetime     | 创建时间              |
| updated_at | datetime     | 更新时间              |
| is_deleted | tinyint(1)   | 逻辑删除（0-未删除，1-已删除） |

### `shop_products` - 商品信息表

| 字段名         | 类型           | 描述                |
|-------------|--------------|-------------------|
| id          | bigint       | 商品主键              |
| shop_id     | bigint       | 商家外键              |
| name        | varchar(256) | 商品名               |
| description | varchar(512) | 商品详细描述            |
| img_url     | varchar(256) | 图片地址              |
| count       | int          | 剩余货量              |
| price       | int          | 商品价格              |
| created_at  | datetime     | 创建时间              |
| updated_at  | datetime     | 更新时间              |
| is_deleted  | tinyint(1)   | 逻辑删除（0-未删除，1-已删除） |

### `shopping_info` - 用户的收货地址信息表

| 字段名        | 类型           | 描述                |
|------------|--------------|-------------------|
| id         | bigint       | 收货信息主键            |
| uid        | bigint       | 用户主键              |
| name       | varchar(64)  | 收货姓名              |
| location   | varchar(256) | 收货地址              |
| phone      | varchar(32)  | 联系电话              |
| created_at | datetime     | 创建时间              |
| updated_at | datetime     | 更新时间              |
| is_deleted | tinyint(1)   | 逻辑删除（0-未删除，1-已删除） |

### `student` - 用户信息表

| 字段名        | 类型           | 描述                  |
|------------|--------------|---------------------|
| id         | bigint       | 学生主键                |
| username   | varchar(256) | 学生登陆账号              |
| password   | varchar(256) | 学生登陆密码              |
| role       | tinyint      | 用户角色（0-学生，1-消费者和跑腿） |
| created_at | datetime     | 创建时间                |
| updated_at | datetime     | 更新时间                |
| is_deleted | tinyint(1)   | 逻辑删除（0-未删除，1-已删除）   |